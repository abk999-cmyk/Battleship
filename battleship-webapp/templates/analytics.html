{% extends "base.html" %}

{% block title %}Analytics - AI Performance Analysis{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="text-center mb-4">
            <i class="fas fa-chart-line text-primary"></i> AI Performance Analytics
        </h1>
        <p class="text-center text-muted">Deep analysis of AI agent performance and strategies</p>
    </div>
</div>

<!-- Key Metrics -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-trophy text-warning"></i> Top Performer
                </h5>
                <h3 class="text-warning" id="topPerformer">AIAgent3</h3>
                <small class="text-muted">96.2% win rate</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-clock text-info"></i> Fastest AI
                </h5>
                <h3 class="text-info" id="fastestAI">AIAgent4</h3>
                <small class="text-muted">43.7 avg moves</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-bullseye text-success"></i> Best Accuracy
                </h5>
                <h3 class="text-success" id="bestAccuracy">AIAgent3</h3>
                <small class="text-muted">41.5% hit rate</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-database text-secondary"></i> Total Games
                </h5>
                <h3 class="text-secondary" id="totalGames">0</h3>
                <small class="text-muted">analyzed</small>
            </div>
        </div>
    </div>
</div>

<!-- Analysis Controls -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-filter"></i> Analysis Filters</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <label for="analysisType" class="form-label">Analysis Type</label>
                        <select class="form-select" id="analysisType">
                            <option value="performance">Performance Overview</option>
                            <option value="head_to_head">Head-to-Head Comparison</option>
                            <option value="strategy">Strategy Analysis</option>
                            <option value="learning_curve">Learning Curves</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="timeRange" class="form-label">Time Range</label>
                        <select class="form-select" id="timeRange">
                            <option value="all">All Time</option>
                            <option value="today">Today</option>
                            <option value="week">Last Week</option>
                            <option value="month">Last Month</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="agentFilter" class="form-label">AI Agents</label>
                        <select class="form-select" id="agentFilter">
                            <option value="all">All Agents</option>
                            <option value="advanced">Advanced Only</option>
                            <option value="benchmark">Benchmarks Only</option>
                        </select>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button class="btn btn-primary w-100" onclick="runAnalysis()">
                            <i class="fas fa-chart-bar"></i> Run Analysis
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Visualization Area -->
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5><i class="fas fa-chart-area"></i> Performance Visualization</h5>
                <div class="btn-group btn-group-sm">
                    <button type="button" class="btn btn-outline-primary" onclick="exportChart()">
                        <i class="fas fa-download"></i> Export
                    </button>
                    <button type="button" class="btn btn-outline-primary" onclick="fullscreenChart()">
                        <i class="fas fa-expand"></i> Fullscreen
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div id="chartContainer" class="text-center" style="height: 400px;">
                    <div class="d-flex align-items-center justify-content-center h-100 text-muted">
                        <div>
                            <i class="fas fa-chart-line fa-3x mb-3"></i>
                            <p>Select analysis options and click "Run Analysis" to view charts</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-list-alt"></i> Analysis Insights</h5>
            </div>
            <div class="card-body">
                <div id="insightsContainer">
                    <div class="text-muted">
                        <i class="fas fa-lightbulb"></i> Run an analysis to see insights
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5><i class="fas fa-star"></i> Agent Rankings</h5>
            </div>
            <div class="card-body">
                <div id="rankingsContainer">
                    <div class="ranking-item mb-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="badge bg-warning me-2">1</span>
                                <strong>AIAgent3</strong>
                            </div>
                            <span class="text-success">96.2%</span>
                        </div>
                    </div>
                    <div class="ranking-item mb-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="badge bg-light text-dark me-2">2</span>
                                <strong>AIPlayer2</strong>
                            </div>
                            <span class="text-success">86.4%</span>
                        </div>
                    </div>
                    <div class="ranking-item mb-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="badge bg-secondary me-2">3</span>
                                <strong>AIPlayer</strong>
                            </div>
                            <span class="text-warning">75.9%</span>
                        </div>
                    </div>
                    <div class="ranking-item mb-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="badge bg-secondary me-2">4</span>
                                <strong>Ultimate</strong>
                            </div>
                            <span class="text-warning">62.8%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Detailed Analysis Table -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-table"></i> Detailed Performance Metrics</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="metricsTable">
                        <thead>
                            <tr>
                                <th>Agent</th>
                                <th>Win Rate</th>
                                <th>Avg Moves/Win</th>
                                <th>Hit Rate</th>
                                <th>Efficiency</th>
                                <th>Learning Rate</th>
                                <th>Consistency</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>AIAgent3</strong></td>
                                <td><span class="badge bg-success">96.2%</span></td>
                                <td>43.7</td>
                                <td>41.5%</td>
                                <td><span class="badge bg-success">Excellent</span></td>
                                <td>High</td>
                                <td>95.8%</td>
                                <td><span class="badge bg-success">Active</span></td>
                            </tr>
                            <tr>
                                <td><strong>AIPlayer2</strong></td>
                                <td><span class="badge bg-success">86.4%</span></td>
                                <td>52.3</td>
                                <td>32.7%</td>
                                <td><span class="badge bg-warning">Good</span></td>
                                <td>Medium</td>
                                <td>88.2%</td>
                                <td><span class="badge bg-success">Active</span></td>
                            </tr>
                            <tr>
                                <td><strong>AIPlayer</strong></td>
                                <td><span class="badge bg-warning">75.9%</span></td>
                                <td>63.2</td>
                                <td>26.9%</td>
                                <td><span class="badge bg-warning">Fair</span></td>
                                <td>Low</td>
                                <td>82.1%</td>
                                <td><span class="badge bg-success">Active</span></td>
                            </tr>
                            <tr>
                                <td><strong>Ultimate</strong></td>
                                <td><span class="badge bg-warning">62.8%</span></td>
                                <td>74.8</td>
                                <td>22.7%</td>
                                <td><span class="badge bg-secondary">Average</span></td>
                                <td>None</td>
                                <td>78.5%</td>
                                <td><span class="badge bg-success">Active</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script>
class Analytics {
    constructor() {
        this.currentChart = null;
        this.loadAnalytics();
    }
    
    async loadAnalytics() {
        // Load initial analytics data
        try {
            // This would be replaced with actual API calls
            console.log('Loading analytics data...');
        } catch (error) {
            console.error('Error loading analytics:', error);
        }
    }
    
    async runAnalysis() {
        const analysisType = document.getElementById('analysisType').value;
        const timeRange = document.getElementById('timeRange').value;
        const agentFilter = document.getElementById('agentFilter').value;
        
        console.log('Running analysis:', {analysisType, timeRange, agentFilter});
        
        // Simulate analysis based on type
        switch(analysisType) {
            case 'performance':
                this.showPerformanceChart();
                break;
            case 'head_to_head':
                this.showHeadToHeadChart();
                break;
            case 'strategy':
                this.showStrategyChart();
                break;
            case 'learning_curve':
                this.showLearningCurveChart();
                break;
        }
        
        this.updateInsights(analysisType);
    }
    
    showPerformanceChart() {
        const ctx = document.createElement('canvas');
        document.getElementById('chartContainer').innerHTML = '';
        document.getElementById('chartContainer').appendChild(ctx);
        
        this.currentChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['AIAgent3', 'AIPlayer2', 'AIPlayer', 'Ultimate', 'Naive10'],
                datasets: [{
                    label: 'Win Rate (%)',
                    data: [96.2, 86.4, 75.9, 62.8, 45.3],
                    backgroundColor: [
                        'rgba(40, 167, 69, 0.8)',
                        'rgba(40, 167, 69, 0.6)',
                        'rgba(255, 193, 7, 0.8)',
                        'rgba(255, 193, 7, 0.6)',
                        'rgba(220, 53, 69, 0.8)'
                    ],
                    borderColor: [
                        'rgba(40, 167, 69, 1)',
                        'rgba(40, 167, 69, 1)',
                        'rgba(255, 193, 7, 1)',
                        'rgba(255, 193, 7, 1)',
                        'rgba(220, 53, 69, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'AI Agent Win Rate Comparison'
                    },
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                }
            }
        });
    }
    
    showHeadToHeadChart() {
        const ctx = document.createElement('canvas');
        document.getElementById('chartContainer').innerHTML = '';
        document.getElementById('chartContainer').appendChild(ctx);
        
        this.currentChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['Win Rate', 'Speed', 'Accuracy', 'Consistency', 'Learning'],
                datasets: [{
                    label: 'AIAgent3',
                    data: [96, 85, 82, 95, 90],
                    backgroundColor: 'rgba(40, 167, 69, 0.2)',
                    borderColor: 'rgba(40, 167, 69, 1)',
                    pointBackgroundColor: 'rgba(40, 167, 69, 1)',
                }, {
                    label: 'AIPlayer2',
                    data: [86, 75, 65, 88, 70],
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Head-to-Head Agent Comparison'
                    }
                },
                scales: {
                    r: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });
    }
    
    showStrategyChart() {
        const ctx = document.createElement('canvas');
        document.getElementById('chartContainer').innerHTML = '';
        document.getElementById('chartContainer').appendChild(ctx);
        
        this.currentChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Neural Network', 'Probability', 'Pattern Recognition', 'Graph Theory', 'Meta Learning'],
                datasets: [{
                    data: [35, 25, 20, 15, 5],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.8)',
                        'rgba(54, 162, 235, 0.8)',
                        'rgba(255, 205, 86, 0.8)',
                        'rgba(75, 192, 192, 0.8)',
                        'rgba(153, 102, 255, 0.8)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'AIAgent3 Strategy Distribution'
                    },
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    }
    
    showLearningCurveChart() {
        const ctx = document.createElement('canvas');
        document.getElementById('chartContainer').innerHTML = '';
        document.getElementById('chartContainer').appendChild(ctx);
        
        const games = Array.from({length: 100}, (_, i) => i + 1);
        const aiAgent3Performance = games.map(g => 70 + Math.log(g) * 8 + Math.random() * 5);
        const aiPlayer2Performance = games.map(g => 60 + Math.log(g) * 6 + Math.random() * 4);
        
        this.currentChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: games,
                datasets: [{
                    label: 'AIAgent3',
                    data: aiAgent3Performance,
                    borderColor: 'rgba(40, 167, 69, 1)',
                    backgroundColor: 'rgba(40, 167, 69, 0.1)',
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'AIPlayer2',
                    data: aiPlayer2Performance,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    backgroundColor: 'rgba(54, 162, 235, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Learning Curve Over Time'
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Games Played'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Win Rate (%)'
                        },
                        min: 50,
                        max: 100
                    }
                }
            }
        });
    }
    
    updateInsights(analysisType) {
        const insights = {
            'performance': [
                'AIAgent3 maintains 96.2% win rate across all opponents',
                'Meta-learning provides 12% advantage over base algorithms',
                'Neural network integration reduces average moves by 23%'
            ],
            'head_to_head': [
                'AIAgent3 vs AIPlayer2: 94% win rate',
                'Consistency is the key differentiator',
                'Learning adaptation gives significant edge'
            ],
            'strategy': [
                'Neural networks contribute 35% to decision making',
                'Probability theory remains foundation (25%)',
                'Graph theory provides tactical advantages'
            ],
            'learning_curve': [
                'Performance plateaus after ~80 games',
                'Rapid improvement in first 20 games',
                'Consistent performance maintenance'
            ]
        };
        
        const container = document.getElementById('insightsContainer');
        const currentInsights = insights[analysisType] || [];
        
        container.innerHTML = currentInsights.map(insight => `
            <div class="insight-item mb-2 p-2 bg-light rounded">
                <i class="fas fa-lightbulb text-warning me-2"></i>
                ${insight}
            </div>
        `).join('');
    }
    
    exportChart() {
        if (this.currentChart) {
            const url = this.currentChart.toBase64Image();
            const a = document.createElement('a');
            a.href = url;
            a.download = 'battleship_analysis_chart.png';
            a.click();
        }
    }
    
    fullscreenChart() {
        // Implement fullscreen functionality
        console.log('Fullscreen chart functionality would be implemented here');
    }
}

// Global functions
let analytics;

function runAnalysis() {
    analytics.runAnalysis();
}

function exportChart() {
    analytics.exportChart();
}

function fullscreenChart() {
    analytics.fullscreenChart();
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    analytics = new Analytics();
});
</script>
{% endblock %}
